#!/usr/bin/env node

'use strict';

var http = require('http');
var iconv = require('iconv-lite');

var options = {
    host: 'www.xalexandre.com.br',
    path: '/piadasAleiatorias/'
};

var callback = function (response) {
    if (response.statusCode !== 200) {
        console.error('Serviço indisponível.');
        process.exit(1);
    }

    response.pipe(iconv.decodeStream('ISO-8859-1')).collect(function (error, body) {
        body = body.replace(/^.*<p>|\s*<\/p>$/g, '');
        body = body.replace(/<br\s\/>/g, '\n');
        body = body.replace(/&mdash;/g, '-');

        console.log(body);
    });
};

http.request(options, callback).on('error', function () {
    console.error('Serviço indisponível.');
    process.exit(1);
}).end();